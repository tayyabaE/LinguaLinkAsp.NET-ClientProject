@model IEnumerable<Web_Based_Learning_System.Models.Lesson>
@{
    Layout = "~/Views/Shared/_LearnerLayout.cshtml";
    ViewData["Title"] = "Lessons";
}

<style>
    .lesson-list-container {
        max-width: 900px;
        margin: 30px auto;
        padding: 0 20px;
    }

    .lesson-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
        border-left: 5px solid #cbd5e1; 
        transition: all 0.3s ease;
        position: relative;
    }

        .lesson-card h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.5rem;
            color: #1e3a8a;
        }

        .lesson-card p {
            font-size: 1rem;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .lesson-card.incomplete:hover {
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.2);
            border-left-color: #3b82f6; 
        }

        .lesson-card.completed {
            background-color: #d1fae5; 
            border-left: 5px solid #059669;
            opacity: 0.9;
            box-shadow: none;
        }

            .lesson-card.completed:hover {
                transform: none; 
                cursor: default;
            }

    p.success-message {
        color: #059669;
        background-color: #e0faef;
        padding: 10px 20px;
        border-radius: 8px;
        border: 1px solid #059669;
        text-align: center;
        font-weight: 600;
        margin-bottom: 20px;
    }

    .lesson-card form button {
        padding: 10px 20px;
        background: linear-gradient(135deg, #22c55e, #16a34a); 
        color: white;
        border-radius: 6px;
        font-weight: 600;
        font-size: 1rem;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        float: right; 
        position: absolute;
        bottom: 25px;
        right: 25px;
    }

        .lesson-card form button:hover {
            background: linear-gradient(135deg, #16a34a, #057833);
            box-shadow: 0 4px 10px rgba(34, 197, 94, 0.4);
        }

    .completion-status {
        color: #059669;
        font-weight: 700;
        font-size: 1.1rem;
        padding: 10px 20px;
        position: absolute;
        bottom: 25px;
        right: 25px;
    }
</style>

<div class="container lesson-list-container">
    <h2>Lessons</h2>

    @if (TempData["Success"] != null)
    {
        <p class="success-message">@TempData["Success"]</p>
    }

    @foreach (var lesson in Model)
    {
        var isCompleted = ViewBag.CompletedLessons != null && ((List<int>)ViewBag.CompletedLessons).Contains(lesson.Id);
        
        <div class="lesson-card @(isCompleted ? "completed" : "incomplete")">
            
            <h3>@lesson.Title</h3>
            
            <p>Lesson content summary goes here...</p>

            @if (!isCompleted)
            {
                <form method="post" action="/Learner/CompleteLesson">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="lessonId" value="@lesson.Id" />
                    <button type="submit">Mark as Completed</button>
                </form>
            }
            else
            {
                <span class="completion-status">Completed ✔</span>
            }
            
            <div style="clear:both;"></div>
        </div>
    }
</div>
